# Sửa lỗi và mẹo

Dưới đây sẽ là hướng dẫn sửa các lỗi khi chơi game Nobihaza, cùng với các mẹo để có thể chơi game tốt hơn trên macOS.

> [!IMPORTANT]
> Nếu như game vẫn còn lỗi sau khi bạn đã áp dụng những cách bên dưới thì khả năng cao là game sẽ không thể chơi (ổn định) trên macOS, và bạn không còn cách nào khác ngoài việc đợi nhà phát triển phát hành bản chính thức.

> [!IMPORTANT]
> "Thư mục game" được nhắc đến trong hướng dẫn này là thư mục game trong thư mục `Program Files` mà bạn đã làm khi [thêm game ở mục 2](2.%20T%E1%BA%A3i%20v%C3%A0%20ch%E1%BA%A1y%20game.md#ch%E1%BA%A1y-b%E1%BA%B1ng-t%E1%BB%87p-rpg_rtexe), thường có dạng là `/Users/tennguoidung/Applications/Nobihaza.app/Contents/drive_c/Program Files/tengame`.

## Chung

Phần này sẽ áp dụng cho tất cả các game mà không xét đến việc game đó được làm bằng phần mềm gì.

### Không thể lưu được tiến trình của game

Áp dụng cho cả 2 trường hợp cơ bản: game báo lỗi khi lưu game và game không hiển thị tệp đã lưu khi khởi động lại game. Riêng với macOS thì một số game sẽ không thể khởi động được nếu như không thể ghi được tệp tin vào thư mục game.

* macOS có thể sẽ chặn các ứng dụng ghi vào các thư mục quan trọng (như `Documents`, `Downloads` hoặc `Applications`). Bạn có thể chuyển game sang thư mục khác, hoặc cấp quyền ghi cho game bằng cách:
    * Mở cài đặt của máy (System Preferences/System Settings) và chọn mục **Security & Privacy**. Chuyển qua tab **Privacy** cho đến khi có danh sách các quyền như ở ảnh bên dưới.<br>![55](images/image-54.png)
    * Nhấn vào biểu tượng khoá ở góc dưới bên trái để mở khoá cài đặt trước. Nhập mật khẩu macOS của bạn và nhấn OK.
    * Nhấn vào mục **Full Disk Access**, sau đó nhấn vào dấu + ở dưới danh sách ứng dụng để mở cửa sổ thêm ứng dụng.<br>![56](images/image-55.png)
    * Chọn ứng dụng/game bạn muốn cấp quyền, ví dụ như ở ảnh dưới là **EasyRPG Player**.<br>![57](images/image-56.png)
    * Đảm bảo ứng dụng bạn vừa thêm đã xuất hiện và có dấu tích ở danh sách.<br>![58](images/image-57.png)

* Đảm bảo đường dẫn của game không chứa bất kì ký tự tiếng Việt có dấu nào (xem mục [`File corrupted! Please run a virus check / No game scripts specified`](#file-corrupted-please-run-a-virus-check--no-game-scripts-specified)).

* Đảm bảo bạn không để thư mục game trong một thư mục/ổ cứng không thể ghi tệp tin được (ví dụ như thẻ SD đang bị khoá ghi, hoặc ổ cứng/thư mục mà bạn không có quyền ghi, hoặc ổ cứng bị lỗi ghi tệp tin). Cách tốt nhất là bạn thử tạo một tệp bất kì trong thư mục game để kiểm tra thử khả năng ghi tệp tin, xem có thông báo lỗi hay yêu cầu cấp quyền gì không, nếu không thì thử di chuyển sang một ổ cứng khác.

* Game sẽ không hoạt động ổn định nếu như bạn để thư mục game trong một ổ cứng lưu trữ đám mây (một số phần mềm như TeraBox, Google Drive hay OneDrive sẽ hiển thị bộ nhớ đám mây của bạn như một ổ cứng).

### Game giật lag mặc dù đang sử dụng máy tính có cấu hình cao

#### Đối với Kegworks

Nếu bạn đang chơi game bằng Wine + Kegworks, bạn cần kiểm tra xem DXVK có hoạt động hay không.

> [!IMPORTANT]
> Đa số các game RPG Maker XP/VX/VX Ace sử dụng DirectX 9 (chứ không phải DirectX 10 hay 11), nên game sẽ chạy rất chậm do DXVK không thể hoạt động được trên DirectX 9 và phải dùng WineD3D để thay thế!
>
> CrossOver có thể cải thiện được tình trạng giật lag này, nhưng vẫn sẽ không hoàn toàn ổn định.

* Mở ứng dụng **KegworksConfig**, chuyển qua tab **Advanced** và tích chọn **Performance HUD** như ảnh dưới.

![59](images/image-58.png)

* Nhấn vào nút **Test Run** để chạy thử game được cài đặt gần nhất và kiểm tra xem có thông tin nào khác liên quan đến DXVK ở màn hình game không. Còn nếu chỉ có màn hình game không mà không có thêm chữ gì thì tức là DXVK đang không hoạt động, nên game sẽ rất là lag.

> [!NOTE]
> Nếu nhấn vào nút **Test Run** mà không có gì xảy ra thì bạn cũng có thể chạy một game mà bạn đã cài thông qua Kegworks.

* Tải phiên bản mới nhất của DXVK [ở đây](https://github.com/Gcenx/DXVK-macOS/releases/latest). Tải tệp tin `dxvk-macOS-*.tar.gz` xuống và giải nén tệp tin đó.

* Mở 2 thư mục này trong Finder của macOS:
    * Thư mục `dxvk-macOS-*` mà bạn vừa giải nén, như ở ảnh bên dưới.<br>![60](images/image-59.png)
    * Thư mục `Contents` của ứng dụng `Nobihaza`, hoặc tên khác mà bạn đã đặt ở mục 1. Xem lại mục [2. Tải và chạy game#Mở ứng dụng Kegworks Config](2.%20T%E1%BA%A3i%20v%C3%A0%20ch%E1%BA%A1y%20game.md#m%E1%BB%9F-%E1%BB%A9ng-d%E1%BB%A5ng-kegworks-config) nếu bạn đã quên.

* Mở ứng dụng **Terminal** lên và nhập dòng chữ sau:

```sh
export NBHZ_PATH=
```

* Kéo thư mục `Contents` vào cửa sổ Terminal, và nó sẽ hiện đường dẫn đầy đủ của thư mục `Contents` như ở ảnh dưới:

![61](images/image-60.png)

* Nhấn nút Enter rồi nhập tiếp:

```sh
export DXVK_PATH=
```

* Kéo thư mục `dxvk-macOS-*` vào cửa sổ Terminal:

![62](images/image-61.png)

* Nhấn Enter tiếp, và cuối cùng là sao chép dòng chữ sau vào cửa sổ Terminal rồi nhấn Enter:

```
cd "$DXVK_PATH"
cp x64/*.dll "$NBHZ_PATH/drive_c/windows/system32"
cp x32/*.dll "$NBHZ_PATH/drive_c/windows/syswow64"
```

* Nếu cửa sổ Terminal không in thêm cái gì khác thì tức là đã thành công, lúc này mở ứng dụng **KegworksConfig** lên và thêm dòng chữ sau vào đầu ô **Unix Commands** (vẫn giữ nguyên đằng sau) như ảnh bên dưới:

```sh
export "d3d10core,d3d11=n,b";
```

![63](images/image-62.png)

* Cuối cùng là tắt KegworksConfig và chạy lại game.

#### Khác

Nếu bạn đang chạy game không thông qua Kegworks, hoặc đã thử cài lại DXVK rồi mà không được thì:

* Nếu bạn đang sử dụng MacBook chạy CPU Intel, bạn nên cắm sạc vào trong quá trình chơi game.

* Tắt bớt các ứng dụng đang chạy, kể cả ứng dụng chạy ngầm. Ở trên thanh Menu của macOS sẽ có cả các ứng dụng đang chạy ngầm, hãy nhấn vào ứng dụng bạn không dùng nữa và nhấn Exit/Quit/Thoát.

![64](images/image-63.png)

* Thử kiểm tra trên thanh Dock xem có ứng dụng nào có chấm trắng bên dưới (đang chạy ngầm) không. Nếu có thì bạn nhấn chuột phải và nhấn **Quit**/**Force Quit**.

![65](images/image-64.png)

* Thử tắt chế độ tiết kiệm pin của macOS.

Nếu game vẫn lag sau khi đã làm đủ cách trên thì không có cách nào khác, game đó sẽ không thể chạy ổn định ở trên macOS.

### Game bị lỗi hiển thị ô vuông/kí tự lạ, hoặc font chữ hiển thị rất xấu

![68](images/image-67.png)

* Xem lại [Điều kiện cơ bản#Chuyển vùng thành Nhật Bản cho Wine](1.%20%C4%90i%E1%BB%81u%20ki%E1%BB%87n%20c%C6%A1%20b%E1%BA%A3n.md#chuy%E1%BB%83n-v%C3%B9ng-th%C3%A0nh-nh%E1%BA%ADt-b%E1%BA%A3n-cho-wine) và [Điều kiện cơ bản#Cài đặt thư viện cần thiết cho Wine](1.%20%C4%90i%E1%BB%81u%20ki%E1%BB%87n%20c%C6%A1%20b%E1%BA%A3n.md#c%C3%A0i-%C4%91%E1%BA%B7t-th%C6%B0-vi%E1%BB%87n-c%E1%BA%A7n-thi%E1%BA%BFt-cho-wine).

* Kiểm tra xem trong thư mục game có tệp tin font chữ (kết thúc bằng `.ttf`, `.otf` hay `.fon`) nào không, nếu có thì:

#### Đối với tệp có đuôi `.ttf` và `.otf`

Mở ứng dụng **Font Book** của macOS lên (có thể tìm trong Launchpad hoặc mục Applications), sau đó kéo các tệp tin `.otf` và `.ttf` vào cửa sổ của Font Book. macOS sẽ tự động cài đặt các font đó cho toàn bộ máy.

#### Đối với tệp có đuôi `.fon`

* Truy cập thư mục `Contents/drive_c/windows/Fonts` của ứng dụng `Nobihaza`, hoặc tên khác mà bạn đã đặt ở mục 1. Xem lại mục [2. Tải và chạy game#Mở ứng dụng Kegworks Config](2.%20T%E1%BA%A3i%20v%C3%A0%20ch%E1%BA%A1y%20game.md#m%E1%BB%9F-%E1%BB%A9ng-d%E1%BB%A5ng-kegworks-config) nếu bạn đã quên.

Thư mục Fonts sẽ như ảnh bên dưới:

![66](images/image-65.png)

* Sao chép font bạn đã tìm được trong thư mục game vào thư mục `Fonts` này.

* Mở ứng dụng **KegworksConfig**, qua tab **Tools** và nhấn **Command Line (cmd)**. Nhập dòng chữ sau vào cửa sổ Command Prompt vừa mở, trong đó `RM2000` là tên của font (thường là tên tệp tin bỏ đuôi `.fon`), và `RM2000.fon` là tên tệp tin:

```bat
reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Fonts" /v "RM2000" /d "RM2000.fon"
```

* Nhấn Enter và bạn sẽ thấy dòng chữ `reg: 操作は正常に完了しました` (`reg: The operation completed successfully`).

> [!NOTE]
> Font Book chỉ hỗ trợ cài đặt các tệp `.otf` và `.ttf`.

## RPG Maker 2000/2003 (`RPG_RT.exe`)

### `XXXX 乗り物 は開けません` (Không thể mở file XXXX) / `???????????????????` (một đống dấu hỏi chấm)

![67](images/image-66.png)

* Xem lại [1. Điều kiện cơ bản#Chuyển vùng thành Nhật Bản cho Wine](1.%20%C4%90i%E1%BB%81u%20ki%E1%BB%87n%20c%C6%A1%20b%E1%BA%A3n.md#chuy%E1%BB%83n-v%C3%B9ng-th%C3%A0nh-nh%E1%BA%ADt-b%E1%BA%A3n-cho-wine).

* Cũng có thể là do tệp tin đó thực sự không có trong thư mục game. Hãy giải nén lại vào thư mục game và thử lại.

### `RPGツクール2000/2003のランタイムパッケージがセットアップされていません。` (Gói khởi chạy của RPG Maker 2000/2003 chưa được cài đặt)

Xem lại [Điều kiện cơ bản#RPG Maker 2000/2003](1.%20Điều%20kiện%20cơ%20bản.md#rpg-maker-20002003).